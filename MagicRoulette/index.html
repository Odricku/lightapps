<!DOCTYPE html>
<html>
<title>Ha hablado la Ruleta Magica!</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<style>
</style>

<head>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<script>
		var pc = ["Tarjeta DG","Tarjeta DRAW","tarjeta FG","Tarjeta GB","Tarjeta GMOD","Tarjeta GTA","Tarjeta HFF","Tarjeta HS","Tarjeta JMC","Tarjeta JMD","Tarjeta JMP","Tarjeta LL","Tarjeta MOD","Tarjeta OC2","Tarjeta PA","Tarjeta PP","Tarjeta PU", "Tarjeta RL", "Tarjeta SR","Tarjeta UCH"];
    	var cel =["Tarjeta JMD","Tarjeta JMP","Tarjeta PU","Tarjeta SG","Tarjeta BF","Tarjeta UNO","Tarjeta DRAW","Tarjeta PS", "Tarjeta G"];
		var custom = []
		
		var names;
		var num;
		
		var regex = /\-{0,1}(\d+)/g;
		var lap = 10;
		var per = 8;
		var rand = 0;
		
		var topValue = 0;
		
		var slots = [];
		
		let timerId;
		var flag = 1;
		var flag2 = 0;
		
		var audioLoop = new Audio('Item roulette Loop.mp3');
		audioLoop.loop = true;
		audioLoop.volume = 0.3;
		var audioEnd = new Audio('Item roulette End.mp3');
		audioEnd.volume = 0.3;
		
		function rellenoInicial(mode){
		
			if(flag == 1){
		
				if(mode == 0){
					names = pc;
				}else if(mode == 1){
					names = cel;
				}else if(mode == 2){
					names = custom;
				}
			
				for(var i = 0; i < names.length; i++){
			
					num = Math.floor(Math.random() * names.length);
					[names[i], names[num]] = [names[num], names[i]];
				
				}
				
				if(names.length > 3){
			
					document.getElementById("slot1").src = names[(num++) % names.length] + ".png";
					document.getElementById("slot2").src = names[(num++) % names.length] + ".png";
					document.getElementById("slot3").src = names[(num++) % names.length] + ".png";
					document.getElementById("slot4").src = names[(num++) % names.length] + ".png";
							
					slots = [document.getElementById("slot1"), document.getElementById("slot2"), document.getElementById("slot3"), document.getElementById("slot4")];
					rellenoRes();
					crearPizza();
				}
				
				else{
					alert("Deben haber al menos 4 opciones");				
					pizza.innerHTML = "";
				}
			}
		}
		
		function rellenoRes(){
		
			var num = [parseInt(slots[0].style.top.match(regex)[0]), parseInt(slots[1].style.top.match(regex)[0]), parseInt(slots[2].style.top.match(regex)[0]),parseInt(slots[3].style.top.match(regex)[0])];
			
			var pos1 = num.indexOf(Math.min(...num));
			num[pos1] = 9999;
			var pos2 = num.indexOf(Math.min(...num));
			num[pos2] = 9999;
			var pos3 = num.indexOf(Math.min(...num));
			num[pos3] = 9999;
			var pos4 = num.indexOf(Math.min(...num));
			num[pos4] = 9999;
			
			slots[pos1].style.transition = "0.5s";
			slots[pos1].style.transform = "translate(-50%, 0%) perspective(50em) rotateX(66deg)";
			slots[pos1].width = 504;
			slots[pos1].style.top = topValue + 22 + "px";
			
			slots[pos2].style.transition = "0.5s";
			slots[pos2].style.transform = "translate(-50%, 0%) perspective(50em) rotateX(0deg)";
			slots[pos2].width = 600;
			slots[pos2].style.top = topValue + 186 + "px";
			
			slots[pos3].style.transition = "0.5s";
			slots[pos3].style.transform = "translate(-50%, 0%) perspective(50em) rotateX(-66deg)";
			slots[pos3].width = 504;
			slots[pos3].style.top = topValue + 386 + "px";
			
			slots[pos4].style.transition = "0.5s";
			slots[pos4].style.transform = "translate(-50%, 0%) perspective(50em) rotateX(-86deg)";
			slots[pos4].width = 424;
			slots[pos4].style.top = topValue + 447 + "px";
			
			
		}
		
		function girar(velGiro){
		
			if(flag == 1){
				if(tombola.style.display != 'none'){
					audioLoop.play();
						
					flag = 0;
					flag2 = 0;
				
					slots = [document.getElementById("slot1"), document.getElementById("slot2"), document.getElementById("slot3"), document.getElementById("slot4")];
					
					slots[0].style.transition = "";
					slots[1].style.transition = "";
					slots[2].style.transition = "";
					slots[3].style.transition = "";
					
					timerId = setInterval(() => girar2(velGiro), velGiro);
					setTimeout(() => { flag = 1;}, (30000/velGiro) + Math.floor(Math.random() * 1000));
				}
				else if(pizza.parentElement.style.display != 'none'){
					audioLoop.play();
					
					flag = 0;
					flag2 = 0;
					
					pizzaGiro(velGiro);
					setTimeout(() => { flag2 = 1;}, (20000/velGiro) + Math.floor(Math.random() * 1000));
				}
			}
		}
		
		function pizzaGiro(velGiro){
			var listTarj = document.getElementsByClassName("slice-cont"); 
			
			timerId = setInterval(()=> {
				console.log(velGiro);
				for(var i = 0; i < listTarj.length; i++){
					listTarj[i].style.transform = "rotateZ(" + (parseInt(listTarj[i].style.transform.match(regex)[0]) + 15)+ "deg)";
					listTarj[i].style.transition = "linear " + (velGiro/1000 + 0.25) + "s";
				}
				if(flag2 == 1){
					clearInterval(timerId);
					if(velGiro < 160){
						flag = 1;
						girar(2 * velGiro);
					}
					else{
						clearInterval(timerId);
						for(var i = 0; i < listTarj.length; i++){
							listTarj[i].style.transform = "rotateZ(" + (parseInt(listTarj[i].style.transform.match(regex)[0]) + 45)+ "deg)";
							listTarj[i].style.transition = "ease-out " + (10 * velGiro/1000) + "s";
						}
						setTimeout(() => { audioLoop.pause(); audioEnd.play(); flag = 1}, 1500 + 5 * velGiro/1000);
					}
				}
			},velGiro);
		}
		
		function girar2(velGiro){
		
			for (var i = 0; i < slots.length; i++) {

				var elem = slots[i];
				
				var angel = parseInt(elem.style.transform.match(regex)[3])
				
				if(angel > 74){
					elem.style.transform = "translate(-50%, 0%) perspective(50em) rotateX(" + ((angel) - 4) + "deg)";
					elem.width = elem.width + 16;
				}
				else if(angel > 42){
					elem.style.transform = "translate(-50%, 0%) perspective(50em) rotateX(" + ((angel) - 4) + "deg)";
					elem.width = elem.width + 16;
					elem.style.top = (parseInt(elem.style.top.match(regex)[0]) + 11) + "px";

				}
				else if(angel > -42){
					elem.style.transform = "translate(-50%, 0%) perspective(50em) rotateX(" + ((angel) - 21) + "deg)";
					elem.style.top = (parseInt(elem.style.top.match(regex)[0]) + 49) + "px";
				}
				
				else if(angel > -74){
					elem.style.transform = "translate(-50%, 0%) perspective(50em) rotateX(" + ((angel) - 4) + "deg)";
					elem.width = elem.width - 16;
					elem.style.top = (parseInt(elem.style.top.match(regex)[0]) + 17) + "px";

				}
				
				else if(angel > -90){
					elem.style.transform = "translate(-50%, 0%) perspective(50em) rotateX(" + ((angel) - 4) + "deg)";
					elem.width = elem.width - 16;
					elem.style.top = (parseInt(elem.style.top.match(regex)[0]) + 9) + "px";

				}
				else{
					elem.src = names[(num++) % names.length] + ".png";
					elem.style.transform = "translate(-50%, 0%) perspective(50em) rotateX(90deg)";
					elem.width = 408;
					elem.style.top = topValue + "px";

				}
				
				if(angel == 21 && flag == 1){
					flag2 = 1;
				}
			}	
			if(flag2 == 1){
				clearInterval(timerId);
				rellenoRes();
				if(velGiro < 40){
					girar(2 * velGiro);
				}
				else{
					audioLoop.pause();
					audioEnd.play();
				}
			}			
		}
		
		function palanca(){
		
			if(flag == 1){
				perilla.style.transform = 'translate(470px, 350px) scale(1)';
				palillo.style.transform = 'translate(480px, 30px) scaleY(-1)';
				setTimeout(()=> {
					fixPalanca();
				}, 1000);
			}
			else{
				palancaTraba();
			}
		}
		
		function palancaTraba(){
			perilla.style.transform = 'translate(470px, 80px) scale(1)';
			palillo.style.transform = 'translate(480px, 30px) scaleY(0.7)';
			setTimeout(()=> {
				fixPalanca();
			}, 500);
			
		}
		
		function fixPalanca(){
			perilla.style.transform = 'translate(470px, 0px) scale(1) ';
			palillo.style.transform = 'translate(480px, 30px) scale(1)';
		}
		
		
		function crearPizza(){
		
			pizza.innerHTML = "";
		
			for(var i = 0; i < names.length; i++){
				pizza.innerHTML = pizza.innerHTML + "<div class=\"slice-cont\"><div class=\"slice\"><img class=\"tarjetapizza\" src=\"" + names[i] + ".png\"></div></div>";
			}
			
			trozar();
		
		}
		
		function trozar(){
		
			var listTrozos = document.getElementsByClassName("slice-cont");
						
			if (listTrozos.length > 3){
						//i
				pizza.style.transform = "translate(-1000px, " + (-100 - 800/listTrozos.length) + "px) scale(0.33)";
				
				for (var i = 0; i < listTrozos.length; i++){
					listTrozos[i].style.height =  2* apotema * Math.tan(Math.PI/listTrozos.length) + "px";
					
					listTrozos[i].style.transform = "rotateZ(" + (i * 360/ listTrozos.length)+ "deg)";
					listTrozos[i].children[0].children[0].style.height =  2* apotema * Math.tan(Math.PI/listTrozos.length) + "px";	
					listTrozos[i].children[0].children[0].style.width =  "75%";	
				
				}
			} //-300 = i           f = -50
		}

		var apotema = 600;
		
		function cambio(){
			if(flag == 1){
				if(pizza.parentElement.style.display == "none"){
					pizza.parentElement.style.display = "block";
					tombola.style.display = "none";
				}
				else{
					tombola.style.display = "block";
					pizza.parentElement.style.display = "none";
				}
			}
		}
		
    </script>
	<style>
	.slice {
		height: 100%;
		width: 2326px;
		transform-origin: 0% 50% 0;
		transform: perspective(10em) translateZ(4rem) rotateY(8.53deg);
	}

	.slice-cont {
		max-width:2326px;
		position:absolute;
		transform-origin: 43% 50% 0;
		transition: linear 0.01s;	
	}
	
	.pizza-cont{   
		margin-left: auto;
		position: absolute;
		top: 0;
		left: 50%;
		width: 2000px;
		height: 1200px;
	}
	
	
	.tarjetapizza{
	
	}	
    </style>
</head>
<body onload="rellenoInicial(0)">
<div>
	<div id="tombola" style="width:100%; min-height:600px;text-align: center;">
		<img src="fondo.png" style="transform: translate(-50%, 0%);top:45px; position:absolute">
		<img src="palillo.png" id="palillo" style="transform-origin: 50% 100%;transition: all 0.5s;-webkit-transition: all 0.5s;transform: translate(480px, 30px);top:45px; position:absolute">
		<img id="slot1" src="" width="408" style="transform: translate(-50%, 0%) perspective(50em) rotateX(90deg);left: 50%;top:0px; position:absolute">
		<img id="slot2" src="" width="408" style="transform: translate(-50%, 0%) perspective(50em) rotateX(90deg);left: 50%;top:0px; position:absolute">
		<img id="slot3" src="" width="408" style="transform: translate(-50%, 0%) perspective(50em) rotateX(90deg);left: 50%;top:0px; position:absolute">
		<img id="slot4" src="" width="408" style="transform: translate(-50%, 0%) perspective(50em) rotateX(90deg);left: 50%;top:0px; position:absolute">
		<img src="ruleta magica.png" style="transform: translate(-50%, 0%);top:45px; position:absolute">	
		<img src="perilla.png" id="perilla" style="transition: all 0.5s;-webkit-transition: all 0.5s;transform: translate(470px, 0px);top:45px; position:absolute" onclick="palanca();girar(10)">		
	</div>
	
	<div style="display:none;background: url(fondoPizza.png) center no-repeat; width:100%; max-height:600px;min-height:600px;text-align: center;">
		<div id= "pizza" class="pizza-cont"></div>
		<img src="clip.png"  style="margin-top:18px; transform: translate(-138px,188px);">
		<img src="cono.png"  style="margin-top:18px; transform: translate(-136px,188px);width: 168px;" onclick="girar(10)">
	
	</div>

	<div style="position: relative;text-align:center;max-width:700px; margin-left:auto; margin-right:auto;">
		<table style="width:100%">
			<tbody>
				<tr><td></td><td></td><td></td><td></td><td></td><td></td></tr>
				<tr>
					<td>
						<input type="button" name="boton" value="TIRA LA RULETA" class="btn btn lg btn-primary btn-block" onclick="girar(10)">
					</td>
					<td>
						<input type="button" name="boton" value="CON MAS SUSPENSO" class="btn btn lg btn-primary btn-block" onclick="girar(5)">
					</td>
					<td>
						<input type="button" name="boton" value="AUN MAS SUSPENSO ðŸ˜±" class="btn btn lg btn-primary btn-block" onclick="girar(3)">
					</td>
				</tr>
				<tr>
					<td>
						<input type="button" name="boton" value="VERSION CELULAR" class="btn btn lg btn-primary btn-block" onclick="rellenoInicial(1)">
					</td>
					<td>
						<input type="button" name="boton" value="VERSION DE PC" class="btn btn lg btn-primary btn-block" onclick="rellenoInicial(0)">
					</td>
					<td>
						<input type="button" name="boton" value="CAMBIAR RULETA" class="btn btn lg btn-primary btn-block" onclick="cambio()">
					</td>
				</tr>
			</tbody>
		</table>
		</br></br>
		Â¿Quieres hacer tu propia ruleta? <a href="custom.html">Entra Aca</a>
	</div>
</div>
</body>
</html>
