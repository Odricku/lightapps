<!DOCTYPE html>
<html>
<title>Ha hablado la Ruleta Magica!</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<style>

</style>

<head>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<script>
		var custom = []
		
		var names;
		var num;
		
		var regex = /\-{0,1}(\d+)/g;
		var lap = 10;
		var per = 8;
		var rand = 0;
		
		var topValue = 0;
		
		var slots = [];
		
		let timerId;
		var flag = 1;
		var flag2 = 0;
		
		var audioLoop = new Audio('Item roulette Loop.mp3');
		audioLoop.loop = true;
		audioLoop.volume = 0.3;
		var audioEnd = new Audio('Item roulette End.mp3');
		audioEnd.volume = 0.3;
		
		function rellenoInicial(){

			names = custom;
		
			for(var i = 0; i < names.length; i++){
		
				num = Math.floor(Math.random() * names.length);
				[names[i], names[num]] = [names[num], names[i]];
			
			}
			
			if(names.length > 3){
		
				document.getElementById("slot1").src = names[(num++) % names.length] + ".png";
				document.getElementById("slot2").src = names[(num++) % names.length] + ".png";
				document.getElementById("slot3").src = names[(num++) % names.length] + ".png";
				document.getElementById("slot4").src = names[(num++) % names.length] + ".png";
						
				slots = [document.getElementById("slot1"), document.getElementById("slot2"), document.getElementById("slot3"), document.getElementById("slot4")];
				rellenoRes();
			}
		}
		
		function rellenoRes(){
		
			var num = [parseInt(slots[0].style.top.match(regex)[0]), parseInt(slots[1].style.top.match(regex)[0]), parseInt(slots[2].style.top.match(regex)[0]),parseInt(slots[3].style.top.match(regex)[0])];
			
			var pos1 = num.indexOf(Math.min(...num));
			num[pos1] = 9999;
			var pos2 = num.indexOf(Math.min(...num));
			num[pos2] = 9999;
			var pos3 = num.indexOf(Math.min(...num));
			num[pos3] = 9999;
			var pos4 = num.indexOf(Math.min(...num));
			num[pos4] = 9999;
			
			slots[pos1].style.transform = "translate(-50%, 0%) perspective(50em) rotateX(66deg)";
			slots[pos1].width = 504;
			slots[pos1].height = 202; 
			slots[pos1].style.top = topValue + 22 + "px";
			
			slots[pos2].style.transform = "translate(-50%, 0%) perspective(50em) rotateX(0deg)";
			slots[pos2].width = 600;
			slots[pos2].height = 240;
			slots[pos2].style.top = topValue + 186 + "px";
			
			slots[pos3].style.transform = "translate(-50%, 0%) perspective(50em) rotateX(-66deg)";
			slots[pos3].width = 504;
			slots[pos2].height = 202;
			slots[pos3].style.top = topValue + 386 + "px";
			
			slots[pos4].style.transform = "translate(-50%, 0%) perspective(50em) rotateX(-86deg)";
			slots[pos4].width = 424;
			slots[pos2].height = 170;
			slots[pos4].style.top = topValue + 447 + "px";
			
			
		}
		
		function girar(velGiro){
			if(names.length > 3){
			
				if(flag == 1){
			
					audioLoop.play();
						
					flag = 0;
					flag2 = 0;
				
					slots = [document.getElementById("slot1"), document.getElementById("slot2"), document.getElementById("slot3"), document.getElementById("slot4")];
					
					timerId = setInterval(() => girar2(velGiro), velGiro);
					setTimeout(() => { flag = 1;}, (30000/velGiro) + Math.floor(Math.random() * 1000));
				}
			}else{
				alert("Deben haber al menos 4 opciones");
			}
		}
		
		function girar2(velGiro){
		
			for (var i = 0; i < slots.length; i++) {

				var elem = slots[i];
				
				var angel = parseInt(elem.style.transform.match(regex)[3])
				
				if(angel > 74){
					elem.style.transform = "translate(-50%, 0%) perspective(50em) rotateX(" + ((angel) - 4) + "deg)";
					elem.width = elem.width + 16;
				}
				else if(angel > 42){
					elem.style.transform = "translate(-50%, 0%) perspective(50em) rotateX(" + ((angel) - 4) + "deg)";
					elem.width = elem.width + 16;
					elem.style.top = (parseInt(elem.style.top.match(regex)[0]) + 11) + "px";

				}
				else if(angel > -42){
					elem.style.transform = "translate(-50%, 0%) perspective(50em) rotateX(" + ((angel) - 21) + "deg)";
					elem.style.top = (parseInt(elem.style.top.match(regex)[0]) + 49) + "px";
				}
				
				else if(angel > -74){
					elem.style.transform = "translate(-50%, 0%) perspective(50em) rotateX(" + ((angel) - 4) + "deg)";
					elem.width = elem.width - 16;
					elem.style.top = (parseInt(elem.style.top.match(regex)[0]) + 17) + "px";

				}
				
				else if(angel > -90){
					elem.style.transform = "translate(-50%, 0%) perspective(50em) rotateX(" + ((angel) - 4) + "deg)";
					elem.width = elem.width - 16;
					elem.style.top = (parseInt(elem.style.top.match(regex)[0]) + 9) + "px";

				}
				else{
					elem.src = names[(num++) % names.length] + ".png";
					elem.style.transform = "translate(-50%, 0%) perspective(50em) rotateX(90deg)";
					elem.width = 408;
					elem.style.top = topValue + "px";
				}
				
				if(angel == 21 && flag == 1){
					flag2 = 1;
				}
			}	
			if(flag2 == 1){
				clearInterval(timerId);
				rellenoRes();
				if(velGiro < 40){
					girar(2 * velGiro);
				}
				else{
					audioLoop.pause();
					audioEnd.play();
				}
			}			
		}
		
		function limpiar(){
			var res = confirm("Esto eliminara todo y no puede deshacerse, Â¿estas seguro?")
			if (res == true){
				thereallimpiar();
			}
		}
		
		function addTarjeta(){
	
			tarjetacontainer.innerHTML = tarjetacontainer.innerHTML + "<tr><td><img src=\"" + urltarj.value + "\" width=\"400\" height=\"160\"></td><td><input type=\"button\" value=\"ELIMINAR\" class=\"btn btn lg btn-primary btn-block\" onclick=\"deleteTarjeta(this)\"></td></tr>"
			custom.push(urltarj.value);
			urltarj.value = "";
			rellenoInicial();
			
		}

		function deleteTarjeta(node){
		
			custom.splice(elim,1);
			node.parentElement.parentElement.remove();
			rellenoInicial();

		}

		function xPuntitos(num){
			
			var res = "<li class=\"die-item\" data-side=\"" + num + "\">";
			for(var i = 0; i < num ; i++){
				res = res + "<span class=\"dot\"></span>"
			}

			return res + "</li>";

		}
		
    </script>
</head>
<body onload="rellenoInicial(0)">
<div>
	<div style="width:100%; min-height:600px;text-align: center;">
		<img src="fondo.png" style="transform: translate(-50%, 0%);top:45px; position:absolute">
		<img id="slot1" src="" width="408" style="transform: translate(-50%, 0%) perspective(50em) rotateX(90deg);left: 50%;top:0px; position:absolute">
		<img id="slot2" src="" width="408" style="transform: translate(-50%, 0%) perspective(50em) rotateX(90deg);left: 50%;top:0px; position:absolute">
		<img id="slot3" src="" width="408" style="transform: translate(-50%, 0%) perspective(50em) rotateX(90deg);left: 50%;top:0px; position:absolute">
		<img id="slot4" src="" width="408" style="transform: translate(-50%, 0%) perspective(50em) rotateX(90deg);left: 50%;top:0px; position:absolute">
		<img src="ruleta magica.png" style="transform: translate(-50%, 0%);top:45px; position:absolute">		
	</div>
	<div style="text-align:center;max-width:700px; margin-left:auto; margin-right:auto ">
		<table style="width:100%">
			<tbody>
				<tr><td></td><td></td><td></td><td></td><td></td><td></td></tr>
				<tr>
					<td colspan="2">
						<input type="button" name="boton" value="TIRA LA RULETA" class="btn btn lg btn-primary btn-block" onclick="girar(10)">
					</td>
					<td colspan="2">
						<input type="button" name="boton" value="CON MAS SUSPENSO" class="btn btn lg btn-primary btn-block" onclick="girar(5)">
					</td>
					<td colspan="2">
						<input type="button" name="boton" value="AUN MAS SUSPENSO ðŸ˜±" class="btn btn lg btn-primary btn-block" onclick="girar(3)">
					</td>
				</tr>
				<tr>
					<td colspan="3">
						<input type="button" name="boton" value="AGREGAR OPCION" class="btn btn lg btn-primary btn-block" onclick="rellenoInicial(1)">
					</td>
					<td colspan="3">
						<input type="button" name="boton" value="LIMPIAR" class="btn btn lg btn-primary btn-block" onclick="limpiar()">
					</td>
				</tr>
			</tbody>
		</table>
		
	</div>
	<div style="text-align:center; max-width:700px;margin-left:auto; margin-right:auto; margin-top:30px">
		<table style="width:100%">
			<tbody id="tarjetacontainer">
				<tr id="customT1">
					<td>
						TARJETA
					</td>
					<td>
						ACCIONES
					</td>
				</tr>
			</tbody>
		</table>
		<div>
			<input type="text" id="urltarj" placeholder="URL de la imagen (Se reescalara a 500x200)" class="btn btn lg btn-dark btn-block"><input type="button" name="boton" value="AGREGAR TARJETA" class="btn btn lg btn-primary btn-block" onclick="addTarjeta()">
		</div>
	</div>
</div>

</body>
</html>
